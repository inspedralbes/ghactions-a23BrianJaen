name: Preparant per producci√≥
run-name: ${{ github.actor }} est√† pujant l'aplicaci√≥ a PROD  üöÄ
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
        - uses: actions/checkout@v4
        - name: Use Node.js ${{ matrix.node-version }}
          uses: actions/setup-node@v4
          with:
            node-version: ${{ matrix.node-version }}
            cache: 'npm'
        - run: npm install
        - run: npm run build --if-present

        # üëá Store the dist folder
        - uses: actions/upload-artifact@v4
          with:
            name: app-build
            path: dist
  deploy:
      runs-on: ubuntu-latest
      needs: [build]
      steps:
        # üëá Get the dist folder
        - name: Download build artifacts
          uses: actions/download-artifact@v4
          with:
            name: app-build
        - run: ls dist
  Pujar-a-produccio-amb-SCP:
          runs-on: ubuntu-latest
          needs: [deploy]
          steps:
            - name: Obtenint el codi del respositori
              uses: actions/checkout@v4
      
            - name: scp a produccio
              run: |
                echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/prod_key.pem
                chmod 600 ~/prod_key.pem
                cd ${{ github.workspace }}
                npm run build
                scp -r -o stricthostkeychecking=no -o UserKnownHostsFile=/dev/null -i "~/prod_key.pem" ./dist/* ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }}:/home/a23brijaemed/web/a23brijaemed.daw.inspedralbes.cat/public_html/ghactions-a23BrianJaen
                
            - run: echo "üçè This job's status is ${{ job.status }}."
